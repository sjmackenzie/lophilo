# Lophilo Linux

## Configuration

Based on the AT91SAMG45 configuration.

We do `make ARCH=arm at91sam9g45_defconfig` and then make modifications based on our differences.

Below configuration notes for each feature

## General Linux kernel 

* General setup
	* Kernel .config support CONFIG_IKCONFIG
	* /proc/config.gz CONFIG_IKCONFIG_PROC
	* DISABLE Initial RAM filesystem CONFIG_BLK_DEV_INITRD
	* DISABLE Optimize for size CONFIG_CC_OPTIMIZE_FOR_SIZE

* System type
	* Atmel AT91 System-on-Chip
		* AT91_EARLY_USART1

* Boot options
	* Default kernel command string: mem=128M console=ttyS1,115200o81 rw
		* no initrd drive
		* mem=128M
		* root device (MicroSD card, 2nd partition) 
		* console=ttyS1,115200o81
			* Speed (baud): 115200		
			* Data bits: 8
			* Stop bits: 1
			* Parity: Odd -> o
			* Flow control: none

* Enable the block layer
	* Advanced partition selection CONFIG_PARTITION_ADVANCED
		* CONFIG_MSDOS_PARTITION
	* I/O Schedulers -> No-op

* Filesystems
	* DISABLE CONFIG_EXT2_FS
	* CONFIG_EXT4_FS
	* CONFIG_MSDOS_FS (strangely, VFAT is enabled...)

Atmel specific (already enabled by default):

* Device drivers
	* Sound card support
		* CONFIG_SND_ATMEL_AC97C

* Device Drivers
	* Character devices
		* Serial drivers
			* CONFIG_SERIAL_ATMEL
			* CONFIG_SERIAL_ATMEL_CONSOLE
			* DISABLE CONFIG_SERIAL_ATMEL_PDC
			Note that break and error handling currently doesn't work properly when DMA is enabled. Make sure that ports where this matters don't use DMA.   
		* CONFIG_HW_RANDOM_ATMEL



## Wifi header

* cfg80211 /  firmware file rtlwifi/rtl8192cufw.bin
* CONFIG_CFG80211 should be enabled

## MicroSD card

Partitioning 

see : https://code.google.com/p/beagleboard/wiki/LinuxBootDiskFormat

	Disk /dev/sdb: 7964 MB, 7964983296 bytes
	91 heads, 18 sectors/track, 9497 cylinders, total 15556608 sectors
	Units = sectors of 1 * 512 = 512 bytes
	Sector size (logical/physical): 512 bytes / 512 bytes
	I/O size (minimum/optimal): 512 bytes / 512 bytes
	Disk identifier: 0x00000000

	   Device Boot      Start         End      Blocks   Id  System
	/dev/sdb1            8192    15556607     7774208    b  W95 FAT32

the card has:  7964983296 bytes

Create new FAT32 partition:

	d 1 n p 1 <enter> +1G 

Set partition type to W95 FAT32

	t 1 b

Make it bootable:
	a 1

Create new ext4 partition
	n p 2 <enter> <enter>

Output should be:

	   Device Boot      Start         End      Blocks   Id  System
	/dev/sdb1   *        2048     2099199     1048576    b  W95 FAT32
	/dev/sdb2         2099200    15556607     6728704   83  Linux

Write out with `w`

## compile errors

/home/rngadam/lophilo/upstream/linux/arch/arm/include/asm/memory.h:169:0: warning: "PHYS_OFFSET" redefined [enabled by default]
/home/rngadam/lophilo/upstream/linux/arch/arm/include/asm/memory.h:148:0: note: this is the location of the previous definition

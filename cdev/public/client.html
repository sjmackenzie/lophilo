<html>
<head>
<script type="text/javascript" src="/smoothie.js"></script>
<script type="text/javascript" src="http://localhost:8001/socket.io/socket.io.js"></script>
<script type="text/javascript" src="http://jsxt.googlecode.com/svn/trunk/js/String.js"></script>
<script>
	function process_data(data) {
		//console.log(data['timestamp']);
		if(data['source'] == lophilo_configuration['last_update_usec_id']) {
			last_update_usec = data['value'];
			document.getElementById('timestamp').innerHTML = '%d.%06d'.sprintf(last_update_sec, last_update_usec);
		} else if(data['source'] == lophilo_configuration['last_update_sec_id']) {
			last_update_sec = data['value'];
			document.getElementById('timestamp').innerHTML = '%d.%06d'.sprintf(last_update_sec, last_update_usec);
		} else if(data['source'] == lophilo_configuration['pin_xa0_id']) {
			//time_series.append(last_update_sec*1000, data['value']);
		}
		//socket.emit('lophilo', { my: 'data' });
	}
	var time_series = new TimeSeries();
	var socket = io.connect('http://localhost:8001');
        var last_update_sec = 0;
        var last_update_usec = 0;
        var lophilo_configuration;
	socket.on('lophilo_configuration', function (data) {
		lophilo_configuration = data;
	});
	socket.on('lophilo_update', function (data) {
		data.forEach(process_data);
	});
      
      function createTimeline() {
        var chart = new SmoothieChart();
        chart.addTimeSeries(time_series, { strokeStyle: 'rgba(0, 255, 0, 1)', fillStyle: 'rgba(0, 255, 0, 0.2)', lineWidth: 4 });
        chart.streamTo(document.getElementById("chart"), 1000);
      }
</script>
</head>
<body onload="createTimeline()" style="background-color:#333333">
	<canvas id="chart" width="500" height="250"></canvas>
	<b id='timestamp'>dude</b>
</body>
</html>
